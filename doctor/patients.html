<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>My Patients - MedSafe</title><link rel="stylesheet" href="../css/style.css"><script src="https://unpkg.com/lucide@latest"></script><script type="module" src="../js/sidebar.js"></script><style>.split-view {
    display: grid;
    grid-template-columns: 350px 1fr;
    gap: 1.5rem;
    height: calc(100vh - 4rem - 60px);
    /* Adjust for header/padding */
}

.patient-list-panel {
    background: white;
    border-radius: 12px;
    border: 1px solid #E2E8F0;
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

.search-area {
    padding: 1rem;
    border-bottom: 1px solid #E2E8F0;
}

.patient-list {
    flex: 1;
    overflow-y: auto;
}

.patient-item {
    padding: 1rem;
    border-bottom: 1px solid #F1F5F9;
    cursor: pointer;
    transition: background 0.2s;
}

.patient-item:hover,
.patient-item.active {
    background-color: var(--secondary);
}

.patient-detail-panel {
    background: white;
    border-radius: 12px;
    border: 1px solid #E2E8F0;
    padding: 2rem;
    overflow-y: auto;
}

.detail-section {
    padding-bottom: 1.5rem;
    margin-bottom: 1.5rem;
    border-bottom: 1px solid #F1F5F9;
}

.timeline-item {
    display: flex;
    gap: 1rem;
    margin-bottom: 1rem;
}

.timeline-line {
    display: flex;
    flex-direction: column;
    align-items: center;
}

.timeline-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: var(--primary);
    margin-top: 6px;
}

.timeline-connector {
    flex: 1;
    width: 2px;
    background: #E2E8F0;
    margin-top: 4px;
}

</style></head><body><div class="dashboard-layout"><app-sidebar></app-sidebar><main class="main-content"><header style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;"><h1>My Patients</h1><button class="btn btn-primary" id="btn-add-patient">+Add Patient</button></header><div class="split-view">< !-- LEFT: List --><div class="patient-list-panel"><div class="search-area"><input type="text" id="patient-search" placeholder="Search by ID or Name..." style="margin-bottom: 0;"></div><div class="patient-list" id="patient-list-container">< !-- Dynamic List --></div></div>< !-- RIGHT: Details --><div class="patient-detail-panel" id="detail-panel"><div style="text-align: center; color: var(--text-muted); padding-top: 4rem;"><i data-lucide="user-search" style="width: 48px; height: 48px; margin-bottom: 1rem;"></i><p>Select a patient to view details</p></div></div></div></main></div>< !-- ADD PATIENT MODAL --><div class="modal-overlay" id="add-modal"><div class="modal"><div class="modal-header"><h3>Add New Patient</h3><button class="close-modal"><i data-lucide="x"></i></button></div><form id="add-patient-form"><div class="form-group"><label>Age</label><input type="number" name="age" required min="0" max="120"></div><div class="form-group"><label>Gender</label><select name="gender"><option value="Male">Male</option><option value="Female">Female</option><option value="Other">Other</option></select></div>< !-- Initial Drug Entry --><div class="form-group"><label>Current Medication</label><input type="text" name="drugName" required placeholder="e.g. Lisinopril"></div><div class="form-group"><label>Reported Symptoms (if any)</label><textarea name="symptoms" placeholder="e.g. Dizziness, Dry Cough"></textarea></div><div style="display: flex; justify-content: flex-end; gap: 1rem;"><button type="button" class="btn btn-outline close-modal">Cancel</button><button type="submit" class="btn btn-primary">Save Patient</button></div></form></div></div><script type="module">import {
    Auth
}

from '../js/auth.js';

import {
    DoctorApp
}

from '../js/doctor.js';
lucide.createIcons();
Auth.requireAuth();

const listContainer=document.getElementById('patient-list-container');
const detailPanel=document.getElementById('detail-panel');
const modal=document.getElementById('add-modal');
const searchInput=document.getElementById('patient-search');

let patients=DoctorApp.getPatients();
let selectedId=new URLSearchParams(window.location.search).get('id');

// Functions
function renderList(filter='') {
    const filtered=patients.filter(p=> p.id.toLowerCase().includes(filter.toLowerCase()) || (p.drugName || '').toLowerCase().includes(filter.toLowerCase()));

    listContainer.innerHTML=filtered.map(p=> ` <div class="patient-item ${p.id === selectedId ? 'active' : ''}" onclick="window.location.search='?id=${p.id}'" > <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;" > <strong style="color: var(--primary-dark);" >$ {
            p.id
        }

        </strong> $ {
            DoctorApp.renderRiskBadge(p.riskLevel)
        }

        </div> <div style="font-size: 0.85rem; color: var(--text-muted);" > $ {
            p.age
        }

        yrs • $ {
            p.gender
        }

        • $ {
            p.drugName || 'No Meds'
        }

        </div> </div> `).join('');

    if (filtered.length===0) {
        listContainer.innerHTML='<p style="padding: 1rem; text-align: center;">No patients found.</p>';
    }
}

function renderDetail(id) {
    const patient=patients.find(p=> p.id===id);
    if ( !patient) return;

    detailPanel.innerHTML=` <div class="detail-section"><div style="display: flex; justify-content: space-between; align-items: start;"><div><h2 style="margin-bottom: 0.5rem;">$ {
        patient.id
    }

    </h2><p>$ {
        patient.age
    }

    years old • $ {
        patient.gender
    }

    </p></div>$ {
        DoctorApp.renderRiskBadge(patient.riskLevel)
    }

    </div></div><div class="detail-section"><h4>Medication Profile</h4><div class="card" style="border: 1px solid #E2E8F0; box-shadow: none;"><strong>$ {
        patient.drugName
    }

    </strong><p style="margin-top: 0.5rem; font-size: 0.9rem;">Status: <span style="color: var(--primary-dark); font-weight: 500;">Active</span></p></div></div><div class="detail-section"><h4>Side Effect Timeline</h4><div class="timeline-item"><div class="timeline-line"><div class="timeline-dot"></div><div class="timeline-connector"></div></div><div><strong>Initial Report</strong><p style="font-size: 0.85rem;">$ {
        new Date(patient.created_at).toLocaleDateString()
    }

    </p><p>$ {
        patient.symptoms || 'No symptoms reported initially.'
    }

    </p></div></div></div><div class="detail-section"><h4>AI Risk Analysis</h4><div style="background: var(--secondary); padding: 1rem; border-radius: 8px;"><p style="margin-bottom: 0.5rem;"><strong>Analysis:</strong>$ {
        patient.riskLevel
    }

    Risk based on reported symptoms.</p><p style="font-size: 0.9rem;">Model detected potential correlation with known side effects of $ {
        patient.drugName
    }

    . Recommend monitoring.</p></div></div>`;
}

// Init
renderList();
if (selectedId) renderDetail(selectedId);

// Event Listeners
searchInput.addEventListener('input', (e)=> renderList(e.target.value));

// Modal
const btnAdd=document.getElementById('btn-add-patient');
const btnClose=document.querySelectorAll('.close-modal');

btnAdd.addEventListener('click', ()=> modal.classList.add('active'));
btnClose.forEach(btn=> btn.addEventListener('click', ()=> modal.classList.remove('active')));

document.getElementById('add-patient-form').addEventListener('submit', (e)=> {
        e.preventDefault();
        const formData=new FormData(e.target);
        const data=Object.fromEntries(formData.entries());

        // Simple logic to determine risk mock
        let risk='Low';
        if (data.symptoms.length > 20) risk='Medium';
        if (data.symptoms.toLowerCase().includes('heart') || data.symptoms.toLowerCase().includes('breath')) risk='High';

        const newPatient=DoctorApp.createPatient({
            ...data, riskLevel: risk
        });

    patients=DoctorApp.getPatients(); // refresh local list
    renderList(searchInput.value);
    modal.classList.remove('active');
    e.target.reset();
    // Select new patient
    window.location.search='?id=' + newPatient.id;
});

</script></body></html>