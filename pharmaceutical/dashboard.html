< !DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Pharma Intelligence - MedSafe</title><link rel="stylesheet" href="../css/style.css"><script src="https://unpkg.com/lucide@latest"></script><script src="https://cdn.jsdelivr.net/npm/chart.js"></script>< !-- Chart.js --><script type="module" src="../js/sidebar.js"></script></head><body><div class="dashboard-layout"><app-sidebar></app-sidebar><main class="main-content"><header style="margin-bottom: 2rem;"><h1>Safety Intelligence</h1><p>Population-level signal detection & analytics</p></header>< !-- KPI Cards --><div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;"><div class="card"><p style="margin: 0; font-size: 0.9rem;">Total Reports Processed</p><h2 id="kpi-total" style="font-size: 2.5rem; color: var(--primary-dark); margin: 0.5rem 0;">0</h2></div><div class="card"><p style="margin: 0; font-size: 0.9rem;">High Risk Signals</p><h2 id="kpi-risk" style="font-size: 2.5rem; color: var(--risk-high); margin: 0.5rem 0;">0</h2></div><div class="card"><p style="margin: 0; font-size: 0.9rem;">Avg Patient Age</p><h2 id="kpi-age" style="font-size: 2.5rem; color: var(--accent); margin: 0.5rem 0;">0</h2></div></div>< !-- Charts Row --><div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 1.5rem;"><div class="card"><h3>Risk Distribution</h3><canvas id="riskChart"></canvas></div><div class="card"><h3>Demographic Gender Split</h3><canvas id="genderChart"></canvas></div></div><div class="card" style="margin-top: 2rem;"><h3>Recent Signals</h3><table style="width: 100%; border-collapse: collapse; margin-top: 1rem;"><thead><tr style="text-align: left; border-bottom: 2px solid #F1F5F9; color: var(--text-muted);"><th style="padding: 0.75rem;">ID</th><th style="padding: 0.75rem;">Component</th><th style="padding: 0.75rem;">Reaction</th><th style="padding: 0.75rem;">Severity</th></tr></thead><tbody id="signals-table">< !-- Dynamic --><tr><td colspan="4" style="padding: 1rem; text-align: center;">Processing live feed...</td></tr></tbody></table></div></main></div><script type="module">import {
    Auth
}

from '../js/auth.js';

import {
    PharmaApp
}

from '../js/pharma.js';

const user=Auth.requireAuth();

if (user.role !=='pharma') {
    window.location.href='../login.html';
}

lucide.createIcons();

// Load Stats
const stats=PharmaApp.getAggregateStats();
document.getElementById('kpi-total').textContent=stats.totalReports;
document.getElementById('kpi-risk').textContent=stats.highRiskCount;
document.getElementById('kpi-age').textContent=stats.avgAge;

// Load Risk Chart
const riskDist=PharmaApp.getRiskDistribution();
const ctxRisk=document.getElementById('riskChart').getContext('2d');

new Chart(ctxRisk, {

    type: 'doughnut',
    data: {

        labels: ['Low', 'Medium', 'High'],
        datasets: [ {
            data: [riskDist.low, riskDist.medium, riskDist.high],
            backgroundColor: ['#A3C9A8', '#E2C792', '#DCA5A5'],
            borderWidth: 0
        }

        ]
    }

    ,
    options: {
        cutout: '70%'
    }
});

// Load Gender Chart
const ctxGender=document.getElementById('genderChart').getContext('2d');

new Chart(ctxGender, {

    type: 'bar',
    data: {

        labels: ['Male', 'Female', 'Other'],
        datasets: [ {
            label: 'Reports',
            data: [stats.genderDist.male, stats.genderDist.female, stats.genderDist.other],
            backgroundColor: ['#8DA399', '#8DA399', '#8DA399'],
            borderRadius: 4
        }

        ]
    }

    ,
    options: {
        scales: {
            y: {
                beginAtZero: true
            }
        }
    }
});

// Populate Table (Top 5 Recent)
const allData=PharmaApp.getAllData().reverse().slice(0, 5);
const tableBody=document.getElementById('signals-table');

if (allData.length > 0) {
    tableBody.innerHTML=allData.map(p=> ` <tr style="border-bottom: 1px solid #F1F5F9;" > <td style="padding: 0.75rem; font-family: monospace;" >$ {
            p.id
        }

        </td> <td style="padding: 0.75rem;" >$ {
            p.drugName || 'N/A'
        }

        </td> <td style="padding: 0.75rem;" >$ {
            p.symptoms || 'None'
        }

        </td> <td style="padding: 0.75rem;" ><span class="badge badge-${p.riskLevel.toLowerCase()}" >$ {
            p.riskLevel
        }

        </span></td> </tr> `).join('');
}

else {
    tableBody.innerHTML='<tr><td colspan="4" style="padding: 1rem; text-align: center;">No data available. Doctors must submit reports first.</td></tr>';
}

</script></body></html>