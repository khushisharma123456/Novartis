<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Doctor Dashboard - Inteleyzer</title><link rel="stylesheet" href="/static/css/style.css"><script src="https://unpkg.com/lucide@latest"></script><script type="module" src="/static/js/sidebar.js"></script></head><body><div class="dashboard-layout"><app-sidebar></app-sidebar><main class="main-content"><header style="display: flex; flex-direction: column; align-items: center; margin-bottom: 2rem; text-align: center;"><div><h1>Dashboard</h1><p>Welcome back, <span id="doctor-name">Doctor</span></p></div></header><div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;"><div class="card"><div style="display: flex; justify-content: space-between; align-items: start;"><div><p style="margin: 0; font-size: 0.9rem;">Active Patients</p><h2 style="margin: 0.5rem 0 0 0; font-size: 2rem;" id="stat-total">0</h2></div><div style="padding: 0.5rem; background: var(--secondary); border-radius: 8px; color: var(--primary-dark);"><i data-lucide="users"></i></div></div></div><div class="card"><div style="display: flex; justify-content: space-between; align-items: start;"><div><p style="margin: 0; font-size: 0.9rem;">High Risk Alerts</p><h2 style="margin: 0.5rem 0 0 0; font-size: 2rem; color: #DC2626;" id="stat-high">0</h2></div><div style="padding: 0.5rem; background: #FEF2F2; border-radius: 8px; color: #DC2626;"><i data-lucide="alert-triangle"></i></div></div></div><div class="card"><div style="display: flex; justify-content: space-between; align-items: start;"><div><p style="margin: 0; font-size: 0.9rem;">Pending Reviews</p><h2 style="margin: 0.5rem 0 0 0; font-size: 2rem;" id="stat-pending">0</h2></div><div style="padding: 0.5rem; background: var(--secondary); border-radius: 8px; color: var(--text-muted);"><i data-lucide="clipboard-list"></i></div></div></div></div><section><h3 style="margin-bottom: 1rem;">Today's Alerts</h3>
 <div class="card" id="alerts-container"><p style="text-align: center; padding: 2rem;">Loading alerts...</p></div></section></main></div><script type="module">import {
    Auth
}

from '/static/js/auth.js';

import {
    DoctorApp
}

from '/static/js/doctor.js';

const user=Auth.requireAuth();

if (user) {
    // Check if name already starts with "Dr." to avoid duplication
    let displayName = user.name;
    if (!displayName.toLowerCase().startsWith('dr.') && !displayName.toLowerCase().startsWith('dr ')) {
        displayName = 'Dr. ' + displayName;
    }
    document.getElementById('doctor-name').textContent = displayName;
}

lucide.createIcons();

async function init() {
    try {
        const patients=await DoctorApp.getPatients();

        const total=patients.length;
        const highRisk=patients.filter(p=> p.riskLevel==='High').length;

        document.getElementById('stat-total').textContent=total;
        document.getElementById('stat-high').textContent=highRisk;
        document.getElementById('stat-pending').textContent=Math.floor(total * 0.2);

        const highRiskPatients=patients.filter(p=> p.riskLevel==='High');
        const container=document.getElementById('alerts-container');

        if (highRiskPatients.length > 0) {
            container.innerHTML=`<div style="display: flex; flex-direction: column; gap: 1rem;">${
                highRiskPatients.map(p=> ` <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; border: 1px solid #E2E8F0; border-radius: 8px;" > <div style="display: flex; gap: 1rem; align-items: center;" > <div style="background: #FEF2F2; padding: 0.5rem; border-radius: 50%; color: #DC2626;" > <i data-lucide="alert-octagon" ></i> </div> <div> <strong style="display: block;" >High Risk Detected</strong> <span style="font-size: 0.9rem; color: var(--text-muted);" >Patient ${
                        p.id
                    }

                    - ${
                        p.drugName || 'Unknown Drug'
                    }

                    </span> </div> </div> <a href="/doctor/patients?id=${p.id}" class="btn btn-outline" style="font-size: 0.85rem;" >Review Case</a> </div> `).join('')
            }

            </div>`;
            lucide.createIcons();
        }

        else {
            container.innerHTML='<p style="text-align: center; padding: 2rem;">No active alerts required your attention.</p>';
        }}

    catch (err) {
        console.error("Error loading dashboard data", err);
        document.getElementById('alerts-container').innerHTML='<p style="text-align: center; color: red;">Error loading data.</p>';
    }}

init();
</script></body></html>